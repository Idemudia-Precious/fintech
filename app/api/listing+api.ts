const API_KEY = process.env.CRYPTO_API_KEY;

export async function GET(request: Request) {
  const url = new URL(request.url);
  const limit = url.searchParams.get("limit") || 5;

  const response = await fetch(
    `https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=${limit}&convert=EUR`,
    {
      headers: {
        "X-CMC_PRO_API_KEY": API_KEY!,
      },
    }
  );

  if (!response.ok) {
    return Response.json({ error: "Failed to fetch data" }, { status: response.status });
  }

  const res = await response.json();
  return Response.json(res.data);
  //return Response.json(data);
}

// const data = [
//   { "id": 1, "name": "Bitcoin", "symbol": "BTC", "slug": "bitcoin", "num_market_pairs": 12258, "date_added": "2010-07-13T00:00:00.000Z", "tags": ["mineable", "pow", "sha-256", "store-of-value", "state-channel", "coinbase-ventures-portfolio", "three-arrows-capital-portfolio", "polychain-capital-portfolio", "binance-labs-portfolio", "blockchain-capital-portfolio", "boostvc-portfolio", "cms-holdings-portfolio", "dcg-portfolio", "dragonfly-capital-portfolio", "electric-capital-portfolio", "fabric-ventures-portfolio", "framework-ventures-portfolio", "galaxy-digital-portfolio", "huobi-capital-portfolio", "alameda-research-portfolio", "a16z-portfolio", "1confirmation-portfolio", "winklevoss-capital-portfolio", "usv-portfolio", "placeholder-ventures-portfolio", "pantera-capital-portfolio", "multicoin-capital-portfolio", "paradigm-portfolio", "bitcoin-ecosystem", "layer-1", "ftx-bankruptcy-estate", "2017-2018-alt-season", "us-strategic-crypto-reserve", "binance-ecosystem", "binance-listing"], "max_supply": 21000000, "circulating_supply": 19892671, "total_supply": 19892671, "infinite_supply": false, "platform": null, "cmc_rank": 1, "self_reported_circulating_supply": null, "self_reported_market_cap": null, "tvl_ratio": null, "last_updated": "2025-07-15T10:23:00.000Z", "quote": { "EUR": { "price": 100100.27609979371, "volume_24h": 126730624654.2045, "volume_change_24h": 37.3219, "percent_change_1h": -0.02396197, "percent_change_24h": -4.09350527, "percent_change_7d": 7.64596951, "percent_change_30d": 11.19175833, "percent_change_60d": 12.64364946, "percent_change_90d": 39.35453165, "market_cap": 1991261859462.3599, "market_cap_dominance": 63.3734, "fully_diluted_market_cap": 2102105798095.6655, "tvl": null, "last_updated": "2025-07-15T10:22:02.000Z" } } }, { "id": 1027, "name": "Ethereum", "symbol": "ETH", "slug": "ethereum", "num_market_pairs": 10394, "date_added": "2015-08-07T00:00:00.000Z", "tags": ["pos", "smart-contracts", "ethereum-ecosystem", "coinbase-ventures-portfolio", "three-arrows-capital-portfolio", "polychain-capital-portfolio", "binance-labs-portfolio", "blockchain-capital-portfolio", "boostvc-portfolio", "cms-holdings-portfolio", "dcg-portfolio", "dragonfly-capital-portfolio", "electric-capital-portfolio", "fabric-ventures-portfolio", "framework-ventures-portfolio", "hashkey-capital-portfolio", "kenetic-capital-portfolio", "huobi-capital-portfolio", "alameda-research-portfolio", "a16z-portfolio", "1confirmation-portfolio", "winklevoss-capital-portfolio", "usv-portfolio", "placeholder-ventures-portfolio", "pantera-capital-portfolio", "multicoin-capital-portfolio", "paradigm-portfolio", "ethereum-pow-ecosystem", "layer-1", "ftx-bankruptcy-estate", "sora-ecosystem", "rsk-rbtc-ecosystem", "world-liberty-financial-portfolio", "us-strategic-crypto-reserve", "binance-ecosystem", "binance-listing"], "max_supply": null, "circulating_supply": 120714500.83952598, "total_supply": 120714500.83952598, "infinite_supply": true, "platform": null, "cmc_rank": 2, "self_reported_circulating_supply": null, "self_reported_market_cap": null, "tvl_ratio": null, "last_updated": "2025-07-15T10:23:00.000Z", "quote": { "EUR": { "price": 2549.234670009785, "volume_24h": 28055563628.428215, "volume_change_24h": 18.3846, "percent_change_1h": -0.1188212, "percent_change_24h": -2.18336805, "percent_change_7d": 16.3481231, "percent_change_30d": 18.12033974, "percent_change_60d": 13.64992415, "percent_change_90d": 88.42670121, "market_cap": 307729590713.045, "market_cap_dominance": 9.7937, "fully_diluted_market_cap": 307729590713.0421, "tvl": null, "last_updated": "2025-07-15T10:22:02.000Z" } } }, { "id": 52, "name": "XRP", "symbol": "XRP", "slug": "xrp", "num_market_pairs": 1652, "date_added": "2013-08-04T00:00:00.000Z", "tags": ["medium-of-exchange", "enterprise-solutions", "xrp-ecosystem", "arrington-xrp-capital-portfolio", "galaxy-digital-portfolio", "a16z-portfolio", "pantera-capital-portfolio", "ftx-bankruptcy-estate", "2017-2018-alt-season", "klaytn-ecosystem", "made-in-america", "us-strategic-crypto-reserve", "binance-ecosystem", "binance-listing"], "max_supply": 100000000000, "circulating_supply": 59131625363, "total_supply": 99985946231, "infinite_supply": false, "platform": null, "cmc_rank": 3, "self_reported_circulating_supply": null, "self_reported_market_cap": null, "tvl_ratio": null, "last_updated": "2025-07-15T10:23:00.000Z", "quote": { "EUR": { "price": 2.48996613272956, "volume_24h": 9144248002.886236, "volume_change_24h": -0.6171, "percent_change_1h": 1.1042859, "percent_change_24h": -2.01297568, "percent_change_7d": 26.95240544, "percent_change_30d": 34.48299216, "percent_change_60d": 20.12677825, "percent_change_90d": 40.09970941, "market_cap": 147235744527.12228, "market_cap_dominance": 4.6859, "fully_diluted_market_cap": 248996613272.9556, "tvl": null, "last_updated": "2025-07-15T10:22:02.000Z" } } }, { "id": 825, "name": "Tether USDt", "symbol": "USDT", "slug": "tether", "num_market_pairs": 136744, "date_added": "2015-02-25T00:00:00.000Z", "tags": ["stablecoin", "asset-backed-stablecoin", "usd-stablecoin", "ethereum-pow-ecosystem", "fiat-stablecoin", "tron20-ecosystem", "rsk-rbtc-ecosystem", "world-liberty-financial-portfolio", "binance-ecosystem", "binance-listing", "peaq-ecosystem", "apertum-ecosystem"], "max_supply": null, "circulating_supply": 159886922749.03622, "total_supply": 161817320301.32947, "platform": { "id": 1027, "name": "Ethereum", "symbol": "ETH", "slug": "ethereum", "token_address": "0xdac17f958d2ee523a2206206994597c13d831ec7" }, "infinite_supply": true, "cmc_rank": 4, "self_reported_circulating_supply": null, "self_reported_market_cap": null, "tvl_ratio": null, "last_updated": "2025-07-15T10:22:00.000Z", "quote": { "EUR": { "price": 0.856169501929298, "volume_24h": 113567965057.7134, "volume_change_24h": 10.3322, "percent_change_1h": -0.01487306, "percent_change_24h": -0.01006204, "percent_change_7d": -0.02066495, "percent_change_30d": -0.04535444, "percent_change_60d": -0.01256755, "percent_change_90d": -0.00262297, "market_cap": 136890307015.05049, "market_cap_dominance": 4.3579, "fully_diluted_market_cap": 138543054525.92252, "tvl": null, "last_updated": "2025-07-15T10:22:02.000Z" } } }, { "id": 1839, "name": "BNB", "symbol": "BNB", "slug": "bnb", "num_market_pairs": 2620, "date_added": "2017-07-25T00:00:00.000Z", "tags": ["marketplace", "centralized-exchange", "payments", "smart-contracts", "alameda-research-portfolio", "multicoin-capital-portfolio", "bnb-chain-ecosystem", "layer-1", "alleged-sec-securities", "celsius-bankruptcy-estate", "binance-ecosystem", "binance-listing"], "max_supply": null, "circulating_supply": 139289241.61, "total_supply": 139289241.61, "infinite_supply": false, "platform": null, "cmc_rank": 5, "self_reported_circulating_supply": null, "self_reported_market_cap": null, "tvl_ratio": null, "last_updated": "2025-07-15T10:23:00.000Z", "quote": { "EUR": { "price": 580.0262993579535, "volume_24h": 1809907078.453861, "volume_change_24h": -4.2498, "percent_change_1h": -0.31085922, "percent_change_24h": -3.50307667, "percent_change_7d": 2.61247092, "percent_change_30d": 4.53471227, "percent_change_60d": 3.21717906, "percent_change_90d": 17.02855004, "market_cap": 80791423351.42418, "market_cap_dominance": 2.5712, "fully_diluted_market_cap": 80791423351.42398, "tvl": null, "last_updated": "2025-07-15T10:22:02.000Z" } } }
// ]